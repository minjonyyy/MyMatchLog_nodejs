#!/bin/bash

# í”„ë¡œë•ì…˜ ì„œë²„ í™˜ê²½ë³€ìˆ˜ ì¦‰ì‹œ ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸
echo "ğŸ”§ í”„ë¡œë•ì…˜ ì„œë²„ í™˜ê²½ë³€ìˆ˜ ìˆ˜ì •ì„ ì‹œì‘í•©ë‹ˆë‹¤..."

# SSH ì—°ê²° ë° í™˜ê²½ë³€ìˆ˜ ìˆ˜ì • ëª…ë ¹ì–´
echo "ğŸ“‹ EC2 ì„œë²„ì— ì ‘ì†í•˜ì—¬ ë‹¤ìŒ ëª…ë ¹ì–´ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•´ì£¼ì„¸ìš”:"
echo ""
echo "ssh -i your-key.pem ubuntu@3.37.38.116"
echo ""
echo "cd /opt/mymatchlog"
echo ""
echo "# í˜„ì¬ í™˜ê²½ë³€ìˆ˜ í™•ì¸"
echo "sudo docker-compose exec app env | grep DB_"
echo ""
echo "# ì»¨í…Œì´ë„ˆ ì¤‘ì§€"
echo "sudo docker-compose down"
echo ""
echo "# docker-compose.yml íŒŒì¼ ë°±ì—…"
echo "sudo cp docker-compose.yml docker-compose.yml.backup"
echo ""
echo "# docker-compose.yml íŒŒì¼ ìˆ˜ì •"
echo "sudo nano docker-compose.yml"
echo ""
echo "# environment ì„¹ì…˜ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •:"
echo "environment:"
echo "  - NODE_ENV=production"
echo "  - DB_HOST=\${{ secrets.DB_HOST }}"
echo "  - DB_USER=admin"
echo "  - DB_PASSWORD=\${{ secrets.DB_PASSWORD }}"
echo "  - DB_NAME=mymatchlog_production"
echo "  - DB_PORT=3306"
echo "  - REDIS_HOST=\${{ secrets.REDIS_HOST }}"
echo "  - REDIS_PORT=6379"
echo "  - ACCESS_TOKEN_SECRET_KEY=\${{ secrets.ACCESS_TOKEN_SECRET_KEY }}"
echo "  - REFRESH_TOKEN_SECRET_KEY=\${{ secrets.REFRESH_TOKEN_SECRET_KEY }}"
echo "  - ACCESS_TOKEN_EXPIRES_IN=15m"
echo "  - REFRESH_TOKEN_EXPIRES_IN=7d"
echo "  - AWS_ACCESS_KEY=\${{ secrets.AWS_ACCESS_KEY_ID }}"
echo "  - AWS_SECRET_ACCESS_KEY=\${{ secrets.AWS_SECRET_ACCESS_KEY }}"
echo "  - AWS_S3_REGION=ap-northeast-2"
echo "  - AWS_S3_BUCKET_NAME=your-s3-bucket-name"
echo "  - PORT=3000"
echo ""
echo "# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘"
echo "sudo docker-compose up -d"
echo ""
echo "# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ëŒ€ê¸°"
echo "sleep 30"
echo ""
echo "# ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰"
echo "sudo docker-compose exec app npm run migrate"
echo "sudo docker-compose exec app npm run seed"
echo ""
echo "# ì—°ê²° í…ŒìŠ¤íŠ¸"
echo "curl http://localhost:3000/api/teams"
echo "curl http://localhost:3000/api/stadiums"
echo ""
echo "âœ… ìŠ¤í¬ë¦½íŠ¸ ì™„ë£Œ. ìœ„ ë‹¨ê³„ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•´ì£¼ì„¸ìš”." 