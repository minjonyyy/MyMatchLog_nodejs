openapi: 3.0.0
info:
  title: Events API
  description: 이벤트 관리 및 선착순 참여 API
  version: 1.0.0

paths:
  /api/events:
    get:
      summary: 진행 중인 이벤트 목록을 조회합니다.
      description: |
        현재 시간 기준으로 진행 중인 이벤트 목록을 조회합니다.
        이벤트 시작 시간과 종료 시간을 기준으로 필터링됩니다.
      tags:
        - Events
      responses:
        '200':
          description: 이벤트 목록 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      events:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              example: 1
                            title:
                              type: string
                              example: 'LG 트윈스 홈경기 티켓 이벤트'
                            description:
                              type: string
                              example: 'LG 트윈스 홈경기 티켓을 선착순으로 증정합니다.'
                            start_at:
                              type: string
                              format: date-time
                              example: '2024-07-21T10:00:00Z'
                            end_at:
                              type: string
                              format: date-time
                              example: '2024-07-21T18:00:00Z'
                            gift:
                              type: string
                              example: 'LG 트윈스 홈경기 티켓 2매'
                            capacity:
                              type: integer
                              example: 100
                            participant_count:
                              type: integer
                              example: 45
                            created_at:
                              type: string
                              format: date-time
                              example: '2024-07-20T09:00:00Z'
                            updated_at:
                              type: string
                              format: date-time
                              example: '2024-07-21T15:30:00Z'
                  message:
                    type: string
                    example: '진행 중인 이벤트 목록 조회에 성공했습니다.'
              examples:
                success:
                  summary: 이벤트 목록 조회 성공
                  value:
                    success: true
                    data:
                      events:
                        - id: 1
                          title: 'LG 트윈스 홈경기 티켓 이벤트'
                          description: 'LG 트윈스 홈경기 티켓을 선착순으로 증정합니다.'
                          start_at: '2024-07-21T10:00:00Z'
                          end_at: '2024-07-21T18:00:00Z'
                          gift: 'LG 트윈스 홈경기 티켓 2매'
                          capacity: 100
                          participant_count: 45
                          created_at: '2024-07-20T09:00:00Z'
                          updated_at: '2024-07-21T15:30:00Z'
                        - id: 2
                          title: '두산 베어스 굿즈 이벤트'
                          description: '두산 베어스 공식 굿즈를 선착순으로 증정합니다.'
                          start_at: '2024-07-22T14:00:00Z'
                          end_at: '2024-07-22T20:00:00Z'
                          gift: '두산 베어스 유니폼'
                          capacity: 50
                          participant_count: 12
                          created_at: '2024-07-20T10:00:00Z'
                          updated_at: '2024-07-22T14:30:00Z'
                    message: '진행 중인 이벤트 목록 조회에 성공했습니다.'
                empty:
                  summary: 진행 중인 이벤트 없음
                  value:
                    success: true
                    data:
                      events: []
                    message: '진행 중인 이벤트 목록 조회에 성공했습니다.'

  /api/events/{id}:
    get:
      summary: 특정 이벤트의 상세 정보를 조회합니다.
      description: |
        이벤트 ID를 통해 특정 이벤트의 상세 정보를 조회합니다.
      tags:
        - Events
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: 이벤트 ID
          example: 1
      responses:
        '200':
          description: 이벤트 상세 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      event:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 1
                          title:
                            type: string
                            example: 'LG 트윈스 홈경기 티켓 이벤트'
                          description:
                            type: string
                            example: 'LG 트윈스 홈경기 티켓을 선착순으로 증정합니다.'
                          start_at:
                            type: string
                            format: date-time
                            example: '2024-07-21T10:00:00Z'
                          end_at:
                            type: string
                            format: date-time
                            example: '2024-07-21T18:00:00Z'
                          gift:
                            type: string
                            example: 'LG 트윈스 홈경기 티켓 2매'
                          capacity:
                            type: integer
                            example: 100
                          participant_count:
                            type: integer
                            example: 45
                          created_at:
                            type: string
                            format: date-time
                            example: '2024-07-20T09:00:00Z'
                          updated_at:
                            type: string
                            format: date-time
                            example: '2024-07-21T15:30:00Z'
                  message:
                    type: string
                    example: '이벤트 상세 조회에 성공했습니다.'
        '404':
          description: 이벤트를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/events/{id}/participate:
    post:
      summary: 이벤트에 선착순으로 참여합니다.
      description: |
        Redis 분산 락을 사용하여 동시성 제어를 하며 이벤트에 선착순으로 참여합니다.
        정원이 마감되면 참여가 불가능합니다.
      tags:
        - Events
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: 이벤트 ID
          example: 1
      responses:
        '200':
          description: 이벤트 참여 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      participationId:
                        type: integer
                        example: 123
                  message:
                    type: string
                    example: '이벤트 참여 신청이 완료되었습니다. 결과를 기다려주세요.'
        '400':
          description: 이벤트 참여 기간이 아님
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 이벤트를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: 이미 참여한 이벤트이거나 정원 마감
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: 'EVENT_NOT_FOUND'
            message:
              type: string
              example: '해당 이벤트를 찾을 수 없습니다.'
        timestamp:
          type: string
          format: date-time
          example: '2024-07-21T10:30:00Z'
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
